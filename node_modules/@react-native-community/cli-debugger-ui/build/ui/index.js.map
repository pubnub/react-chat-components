{"version":3,"sources":["../../src/ui/index.js"],"names":["isMacLike","test","navigator","platform","refreshShortcut","window","onload","document","getElementById","innerHTML","Page","render","onReloadClicked","xhr","XMLHttpRequest","open","location","origin","send","state","isDark","localStorage","getItem","matchMedia","matches","isPriorityMaintained","status","type","visibilityState","setState","partialState","Object","assign","statusNode","textContent","error","reason","linkNode","querySelector","href","grayIcon","blueIcon","orangeIcon","darkCheckbox","body","classList","toggle","checked","setItem","maintainPriorityCheckbox","silence","volume","play","pause","toggleDarkTheme","togglePriorityMaintenance","connectToDebuggerProxy","ws","WebSocket","host","worker","createJSRuntime","Worker","onmessage","message","JSON","stringify","data","onbeforeunload","updateVisibility","shutdownJSRuntime","terminate","postMessage","method","onopen","object","parse","$event","console","clear","replyID","id","onclose","warn","setTimeout","addEventListener"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n/* eslint-env browser */\nimport './index.css';\nimport blueIcon from './assets/blue-icon.png';\nimport grayIcon from './assets/gray-icon.png';\nimport orangeIcon from './assets/orange-icon.png';\n\nconst isMacLike = /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform);\nconst refreshShortcut = isMacLike ? '⌘R' : 'Ctrl R';\nwindow.onload = function() {\n  if (!isMacLike) {\n    document.getElementById('shortcut').innerHTML = 'Ctrl⇧J';\n  }\n  Page.render();\n};\n\nwindow.onReloadClicked = function() {\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', `${window.location.origin}/reload`, true);\n  xhr.send();\n};\n\nconst Page = (window.Page = {\n  state: {\n    isDark:\n      localStorage.getItem('darkTheme') === null\n        ? window.matchMedia('(prefers-color-scheme: dark)').matches\n        : localStorage.getItem('darkTheme') === 'on',\n    isPriorityMaintained: localStorage.getItem('maintainPriority') === 'on',\n    status: {type: 'disconnected'},\n    visibilityState: document.visibilityState,\n  },\n\n  setState(partialState) {\n    Page.state = Object.assign({}, Page.state, partialState);\n    Page.render();\n  },\n\n  render() {\n    const {isDark, isPriorityMaintained, status, visibilityState} = Page.state;\n\n    const statusNode = document.getElementById('status');\n    switch (status.type) {\n      case 'connected':\n        statusNode.textContent = 'Debugger session active.';\n        break;\n      case 'error':\n        statusNode.textContent =\n          status.error.reason ||\n          'Disconnected from proxy. Attempting reconnection. Is node server running?';\n        break;\n      case 'connecting':\n      case 'disconnected':\n      // Fall through.\n      default:\n        statusNode.innerHTML =\n          'Waiting, press <span class=\"shortcut\">' +\n          refreshShortcut +\n          '</span> in simulator to reload and connect.';\n        break;\n    }\n\n    const linkNode = document.querySelector('link[rel=icon]');\n    if (status.type === 'disconnected' || status.type === 'error') {\n      linkNode.href = grayIcon;\n    } else {\n      if (visibilityState === 'visible' || isPriorityMaintained) {\n        linkNode.href = blueIcon;\n      } else {\n        linkNode.href = orangeIcon;\n      }\n    }\n\n    const darkCheckbox = document.getElementById('dark');\n    document.body.classList.toggle('dark', isDark);\n    darkCheckbox.checked = isDark;\n    localStorage.setItem('darkTheme', isDark ? 'on' : '');\n\n    const maintainPriorityCheckbox = document.getElementById(\n      'maintain-priority',\n    );\n    const silence = document.getElementById('silence');\n    silence.volume = 0.1;\n    if (isPriorityMaintained) {\n      silence.play();\n    } else {\n      silence.pause();\n    }\n    maintainPriorityCheckbox.checked = isPriorityMaintained;\n    localStorage.setItem('maintainPriority', isPriorityMaintained ? 'on' : '');\n  },\n\n  toggleDarkTheme() {\n    Page.setState({isDark: !Page.state.isDark});\n  },\n\n  togglePriorityMaintenance() {\n    Page.setState({isPriorityMaintained: !Page.state.isPriorityMaintained});\n  },\n});\n\nfunction connectToDebuggerProxy() {\n  const ws = new WebSocket(\n    'ws://' +\n      window.location.host +\n      '/debugger-proxy?role=debugger&name=Chrome',\n  );\n  let worker;\n\n  function createJSRuntime() {\n    // This worker will run the application JavaScript code,\n    // making sure that it's run in an environment without a global\n    // document, to make it consistent with the JSC executor environment.\n    worker = new Worker('./debuggerWorker.js');\n    worker.onmessage = function(message) {\n      ws.send(JSON.stringify(message.data));\n    };\n    window.onbeforeunload = function() {\n      return (\n        'If you reload this page, it is going to break the debugging session. ' +\n        'Press ' +\n        refreshShortcut +\n        ' on the device to reload.'\n      );\n    };\n    updateVisibility();\n  }\n\n  function shutdownJSRuntime() {\n    if (worker) {\n      worker.terminate();\n      worker = null;\n      window.onbeforeunload = null;\n    }\n  }\n\n  function updateVisibility() {\n    if (worker && !Page.state.isPriorityMaintained) {\n      worker.postMessage({\n        method: 'setDebuggerVisibility',\n        visibilityState: document.visibilityState,\n      });\n    }\n    Page.setState({visibilityState: document.visibilityState});\n  }\n\n  ws.onopen = function() {\n    Page.setState({status: {type: 'connecting'}});\n  };\n\n  ws.onmessage = async function(message) {\n    if (!message.data) {\n      return;\n    }\n    const object = JSON.parse(message.data);\n\n    if (object.$event === 'client-disconnected') {\n      shutdownJSRuntime();\n      Page.setState({status: {type: 'disconnected'}});\n      return;\n    }\n\n    if (!object.method) {\n      return;\n    }\n\n    // Special message that asks for a new JS runtime\n    if (object.method === 'prepareJSRuntime') {\n      shutdownJSRuntime();\n      console.clear();\n      createJSRuntime();\n      ws.send(JSON.stringify({replyID: object.id}));\n      Page.setState({status: {type: 'connected', id: object.id}});\n    } else if (object.method === '$disconnected') {\n      shutdownJSRuntime();\n      Page.setState({status: {type: 'disconnected'}});\n    } else {\n      worker.postMessage(object);\n    }\n  };\n\n  ws.onclose = function(error) {\n    shutdownJSRuntime();\n    Page.setState({status: {type: 'error', error}});\n    if (error.reason) {\n      console.warn(error.reason);\n    }\n    setTimeout(connectToDebuggerProxy, 500);\n  };\n\n  // Let debuggerWorker.js know when we're not visible so that we can warn about\n  // poor performance when using remote debugging.\n  document.addEventListener('visibilitychange', updateVisibility, false);\n}\n\nconnectToDebuggerProxy();\n"]}